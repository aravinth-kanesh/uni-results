<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>University Results</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    /* Shake animation for invalid input */
    @keyframes shake {
      0%, 100%  { transform: translateX(0); }
      20%       { transform: translateX(-6px); }
      40%       { transform: translateX(6px); }
      60%       { transform: translateX(-4px); }
      80%       { transform: translateX(4px); }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="header-inner">
      <div class="header-brand">
        <div class="header-logo">ðŸŽ“</div>
        <h1>University Results</h1>
      </div>
      <button class="settings-btn" onclick="openSettings()">
        âš™ Settings
      </button>
    </div>
  </header>

  <!-- Settings modal -->
  <div id="settings-overlay" class="overlay hidden">
    <div class="modal">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="modal-close-btn" onclick="closeSettings()">âœ•</button>
      </div>
      <div class="modal-body">

        <div class="settings-group">
          <h3>Year Configuration</h3>
          <div id="year-settings"></div>
          <button class="btn-add-year" onclick="addYearConfig()">+ Add year</button>
          <p class="settings-note">Weightings don't need to sum to 100. Only years with grades entered contribute to the RWA.</p>
        </div>

        <div class="settings-group">
          <h3>Target Grades</h3>
          <div class="settings-row">
            <label>Targets (comma-separated)</label>
            <input type="text" id="targets-input" value="70, 75, 80" style="width:160px;text-align:left">
          </div>
          <p class="settings-note">e.g. <code>60, 70, 80</code></p>
        </div>

        <div class="settings-group">
          <h3>Data</h3>
          <div class="export-row">
            <button class="btn-export" onclick="exportCSV()">Export CSV</button>
            <button class="btn-export" onclick="exportJSON()">Export JSON</button>
            <button class="btn-export" onclick="document.getElementById('import-input').click()">Import JSON</button>
            <input type="file" id="import-input" accept=".json" style="display:none" onchange="importJSON(event)">
          </div>
          <p class="settings-note">Export saves a backup; import restores from a previously exported JSON file.</p>
        </div>

      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="resetSettings()">Reset Defaults</button>
        <button class="btn-primary" onclick="applySettings()">Apply Changes</button>
      </div>
    </div>
  </div>

  <!-- Main -->
  <main class="main">

    <!-- Stats Overview -->
    <section class="stats-overview">

      <!-- RWA Hero -->
      <div class="rwa-card">
        <div class="rwa-label">Running Weighted Average</div>
        <div class="rwa-value" id="rwa-display">--</div>
        <div class="classification-badge" id="classification-badge">No data yet</div>
        <div class="rwa-breakdown" id="rwa-breakdown"></div>
      </div>

      <!-- Year cards injected by renderStats() -->

    </section>

    <!-- Content Grid -->
    <section class="content-grid">

      <!-- Grade Input Panel -->
      <div class="card">
        <h2>Module Grades</h2>

        <div class="year-tabs"><!-- tabs injected by renderTabs() --></div>

        <!-- Add form -->
        <div class="add-form">
          <div class="form-group">
            <label>Name</label>
            <input type="text" id="name-input" placeholder="Optional" autocomplete="off">
          </div>
          <div class="form-group">
            <label>Grade (%)</label>
            <input type="number" id="grade-input" min="0" max="100"
                   placeholder="e.g. 75" onkeydown="handleEnter(event)" autocomplete="off">
          </div>
          <div class="form-group">
            <label>Credits</label>
            <select id="credits-input">
              <option value="15">15 credits</option>
              <option value="20">20 credits</option>
              <option value="30">30 credits</option>
              <option value="40">40 credits</option>
              <option value="45">45 credits</option>
              <option value="60">60 credits</option>
            </select>
          </div>
          <div class="form-group">
            <label class="label-spacer">&nbsp;</label>
            <button class="btn-add" onclick="addModule()">+ Add</button>
          </div>
        </div>

        <!-- Module list -->
        <div id="modules-container"></div>
      </div>

      <!-- Analysis Column -->
      <div class="analysis-col">

        <!-- Target Analysis -->
        <div class="card">
          <h2>Target Analysis</h2>
          <p class="card-subtitle">Minimum average needed across all remaining credits to hit each target.</p>
          <div id="targets-display"></div>
        </div>

        <!-- What-if -->
        <div class="card">
          <h2>What-if</h2>
          <p class="card-subtitle">Average this grade across all remaining credits and see where you end up.</p>
          <div class="whatif-row">
            <input type="number" class="whatif-input" id="whatif-input" min="0" max="100"
                   placeholder="e.g. 72" oninput="updateWhatIf()" autocomplete="off">
            <div class="whatif-result" id="whatif-result"></div>
          </div>
        </div>

      </div><!-- /analysis-col -->

    </section><!-- /content-grid -->

  </main>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <script src="app.js"></script>
</body>
</html>
